---
title: "Case Study_2"
author: "Julius Mwangi"
date: "July 29, 2018"
output: html_document
---

# INTRODUCTION
*what is the project about - talk about the pumps*

A pump is a device thatpushes liquids, gasses and some light solids through a mechanical process from one loaction to another. They simplify the shifting processes and improve on equipment operational efficiencies. They are used in myriad places including human bodies, engines, water and oil wells etc.

Over the years, pumps have become more and more efficeint in their operation but equaly expensive to purchase and maintain. To enhance their efficiency, pumps are installed as near to the source of what they are hauling as poosible. Often, as in the cse of an oil well, this wold be thousands of fee below the earth, or in the case of ahuman body this will be close to the heart as possible.

*What is the impact of failing pumps*

When a pump fails, it may stall an entire process. In the case of a human being, a heart pump failure may result in death if immediate resoultion is not found. In other instances e.g. oil well, this could mean heavy machinery and field workers being idle as they wait for the replacement. In addition, pump replacement requires specialized techncians and could take severall hours to uninstall the bad pump and install the new pump. One pum faiure could also affect several a=other processes, costing the company thousands of dollars if it happenes witout proper preparations.For example, it may require making immediate arrangements to divertoil delivert to other oil reservoirs, which might not be in a caocity to hndle extra capacity.

* What causes pump failure *

An article posted on the Plant Wellness Way EAM website, "List of 600+ Centrifugal Pump Set Failure Modes" indicated there are over 600 failure modes. In other words, unless you see the actual failed unit it may be difficult to know whay the unit failed.This is worrisomne to any plant manager interetsed to meet deadlines and avoid pump failures. The aricle further distributes pump failure between human error e.g. instalation error, wrong pump being installed, etc or by Materials-of-Construction failure. [^1 https://www.lifetime-reliability.com/cms/free-articles/reliability-improvement/pump-failure-modes-list/]

# PROBLEM STATEMENT
Oil pumps are critical to the efficiency of oil wells. When an oil well is dug, a pump is required to pump the oil out of the well into a storage or to a delivery pipe that delivers the oil into a reservoir near the refinery, where another pump will be used to um the oil into the refinery. When the oils is refined, it will require another pump to pump the oil into other reservoirs waiting distribution. When a (one) pump therefore fails, it's not only costly to remove and replace it, but there is also a cascade effect as it involves not only halting oil production, but transportation as well, jamming reservoirs, and utilizing specialized personnel and equipment to pull the pump out of the well and replace it with a new one according to an article "Pump Failure Prediction" [^1 https://www.maana.io/digital-transformation/pump-failure-prediction/]

If we successfuly predict pump failure before it happens, we can provide this information to the maintenance team who will in turn schedule a close down, and replace all the pumps predicted as calpable to failure. This scheduled maintenance will reduce the indiual replacement cost as specialized pesonnel will pull and replace several pumps; In addition, the prior arrangement will have been made to manage other dependant reservoirs, and also send staff on vacation as the maintenance is being performed.

# DATA SETS AND APPROACH
Our client provided us with eight data sets i.e BearingWear$Outcome;Cavitation$Outcome;
ClosedPressure$Outcome;ClosedSuction$Outcome;CouplingWear$Outcome;Imbalance$Outcome;and 
Misalignment$Outcome. which we considered to be relatively clean. We shall:

Read data from eight different files
Split the data into training and validation sets
Build a model using RandomForest.

```{r}
BearingWear <- read.csv("C:\\Users\\KRamasundaram\\Documents\\MSDS 6306\\Case Study 2\\Data Set\\Bearing_Wear.csv")
head(BearingWear)
Cavitation <- read.csv("C:\\Users\\KRamasundaram\\Documents\\MSDS 6306\\Case Study 2\\Data Set\\Cavitation.csv")
ClosedPressure <- read.csv("C:\\Users\\KRamasundaram\\Documents\\MSDS 6306\\Case Study 2\\Data Set\\Closed_pressure_side.csv")
ClosedSuction <- read.csv("C:\\Users\\KRamasundaram\\Documents\\MSDS 6306\\Case Study 2\\Data Set\\Closed_Suction_Side.csv")
CouplingWear <- read.csv("C:\\Users\\KRamasundaram\\Documents\\MSDS 6306\\Case Study 2\\Data Set\\Coupling_Wear.csv")
Imbalance <- read.csv("C:\\Users\\KRamasundaram\\Documents\\MSDS 6306\\Case Study 2\\Data Set\\Imbalance.csv")
Misalignment <- read.csv("C:\\Users\\KRamasundaram\\Documents\\MSDS 6306\\Case Study 2\\Data Set\\Misalignment.csv")
Normal_Ops <- read.csv("C:\\Users\\KRamasundaram\\Documents\\MSDS 6306\\Case Study 2\\Data Set\\Normal_Operation.csv")

BearingWear$Outcome <- c("Bearing Wear")
Cavitation$Outcome <- c("Cavitation")
ClosedPressure$Outcome <- c("ClosedPressure")
ClosedSuction$Outcome <- c("ClosedSuction")
CouplingWear$Outcome <- c("CouplingWear")
Imbalance$Outcome <- c("Imbalance")
Misalignment$Outcome <- c("Misalignment")
Normal_Ops <- c("Normal")

clean_data <- merge(BearingWear, Cavitation)
head(clean_data)
head(Cavitation)
clean_data <- rbind(BearingWear, ClosedPressure)
```
library(randomForest)

# Read the data from file
```{r}
BearingWear <- read.csv("C:\\Users\\KRamasundaram\\Documents\\MSDS 6306\\Case Study 2\\Data Set\\Bearing_Wear.csv")
head(BearingWear)
Cavitation <- read.csv("C:\\Users\\KRamasundaram\\Documents\\MSDS 6306\\Case Study 2\\Data Set\\Cavitation.csv")
ClosedPressure <- read.csv("C:\\Users\\KRamasundaram\\Documents\\MSDS 6306\\Case Study 2\\Data Set\\Closed_pressure_side.csv")
ClosedSuction <- read.csv("C:\\Users\\KRamasundaram\\Documents\\MSDS 6306\\Case Study 2\\Data Set\\Closed_Suction_Side.csv")
CouplingWear <- read.csv("C:\\Users\\KRamasundaram\\Documents\\MSDS 6306\\Case Study 2\\Data Set\\Coupling_Wear.csv")
Imbalance <- read.csv("C:\\Users\\KRamasundaram\\Documents\\MSDS 6306\\Case Study 2\\Data Set\\Imbalance.csv")
Misalignment <- read.csv("C:\\Users\\KRamasundaram\\Documents\\MSDS 6306\\Case Study 2\\Data Set\\Misalignment.csv")
Normal_Ops <- read.csv("C:\\Users\\KRamasundaram\\Documents\\MSDS 6306\\Case Study 2\\Data Set\\Normal_Operation.csv")
```

# Added a column for outcome
```{r}
BearingWear$Outcome <- c("Bearing Wear")
Cavitation$Outcome <- c("Cavitation")
ClosedPressure$Outcome <- c("Closed Pressure Side")
ClosedSuction$Outcome <- c("Closed Suction Side")
CouplingWear$Outcome <- c("Coupling Wear")
Imbalance$Outcome <- c("Imbalance")
Misalignment$Outcome <- c("Misalignment")
Normal_Ops$Outcome <- c("Normal")

str(BearingWear)
```

# Splitting the data for validation and model building
```{r}
Bearing_val_data <- BearingWear[c(1:as.integer(0.2*nrow(BearingWear))) ,]
Cavitation_val_data <- Cavitation[c(1:as.integer(0.2*nrow(Cavitation))) ,]
ClosedPressure_val_data <- ClosedPressure[c(1:as.integer(0.2*nrow(ClosedPressure))) ,]
ClosedSuction_val_data <- ClosedSuction[c(1:as.integer(0.2*nrow(ClosedSuction))) ,]
CouplingWear_val_data <- CouplingWear[c(1:as.integer(0.2*nrow(CouplingWear))) ,]
Imbalance_val_data <- Imbalance[c(1:as.integer(0.2*nrow(Imbalance))) ,]
Misalignment_val_data <- Misalignment[c(1:as.integer(0.2*nrow(Misalignment))) ,]
Normal_val_data <- Normal_Ops[c(1:as.integer(0.2*nrow(Normal_Ops))) ,]
```

# combine all validation data
```{r}
validation_data <- rbind (Bearing_val_data, Cavitation_val_data)
validation_data <- rbind(validation_data, ClosedPressure_val_data)
validation_data <- rbind(validation_data, ClosedSuction_val_data)
validation_data <- rbind(validation_data, CouplingWear_val_data)
validation_data <- rbind(validation_data, Imbalance_val_data)
validation_data <- rbind(validation_data, Misalignment_val_data)
validation_data <- rbind(validation_data, Normal_val_data)

dim(validation_data)
```

# Model data
```{r}
Bearing_mod_data <- BearingWear[c(1:as.integer(0.8*nrow(BearingWear))) ,]
Cavitation_mod_data <- Cavitation[c(1:as.integer(0.8*nrow(Cavitation))) ,]
ClosedPressure_mod_data <- ClosedPressure[c(1:as.integer(0.8*nrow(ClosedPressure))) ,]
ClosedSuction_mod_data <- ClosedSuction[c(1:as.integer(0.8*nrow(ClosedSuction))) ,]
CouplingWear_mod_data <- CouplingWear[c(1:as.integer(0.8*nrow(CouplingWear))) ,]
Imbalance_mod_data <- Imbalance[c(1:as.integer(0.8*nrow(Imbalance))) ,]
Misalignment_mod_data <- Misalignment[c(1:as.integer(0.8*nrow(Misalignment))) ,]
Normal_mod_data <- Normal_Ops[c(1:as.integer(0.8*nrow(Normal_Ops))) ,]
```

# Consolidate All Model Data
```{r}
model_data <- rbind (Bearing_mod_data, Cavitation_mod_data)
model_data <- rbind(model_data, ClosedPressure_mod_data)
model_data <- rbind(model_data, ClosedSuction_mod_data)
model_data <- rbind(model_data, CouplingWear_mod_data)
model_data <- rbind(model_data, Imbalance_mod_data)
model_data <- rbind(model_data, Misalignment_mod_data)
model_data <- rbind(model_data, Normal_mod_data)

dim(model_data)
dim(validation_data)

M <- model_data[, c(-1, -2, -38)] #Matrix, so remove target, i.e. outcome
L <- as.factor(model_data[, 38]) #labels, so select only target i.e. outcome
```

# Training and Testing
```{r}
pump.rf <- randomForest(M, L)
# evaluating the model
pump.rf
pump.rf$importance

pred <- predict(pump.rf, validation_data[c(1:10), c(-1, -2, -38)])
pred
```
