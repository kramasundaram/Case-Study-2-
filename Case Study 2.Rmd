---
title: "Case Study_2"
author: "Kumar Ramasundaran, Julius Mwangi"
date: "July 29, 2018"
output: html_document
---

## PUMP FAILURE PREDICTIONS

### INTRODUCTION
*what is the project about - talk about the pumps*

A pump is a device that pushes liquids, gasses, and light solids through a mechanical process from one location to another. They simplify the shifting processes and improve on equipment operational efficiencies. They are used in myriad places including human bodies, engines, water, and oil wells etc.

Over the years, pumps have become more and more efficient in their operation but equaly expensive to purchase and maintain. To enhance their efficiency, pumps are installed as near to the source of what they are hauling as poosible. Often, as in the case of an oil well, this would be thousands of feet below the earth, or in the case of a human body this will be close to the heart as possible. To maintain the pumps, an engineer would have to extract the pump, assess the failure, repair, and reinstall. The cos 

*Impact of Failing Pumps

When a pump fails, it most certainly stalls an entire process, as fluids are not moved from one location to the other thus causing pile up both on the loading and the receiving end. The damage may be as extensive and destructive. In the case of a human being, a heart pump failure may result in death if immediate resoultion is not found. For the oil well, this could mean heavy machinery and field workers are rendered idle awaiting replacement, and costing the company millions of dollars in idle costs and revenue losses. In addition, pump replacement requires specialized technicians and in some instances takes severall hours to uninstall the bad pump and install the new/repaired pump. One pump failure could result in a cascade affect several causing failure in multiple processes, costing thousands of dollars if it happens without warning and proper preparations. For example, it may require making immediate arrangements to divert oil delivery to other reservoirs to minimize losses, or stalling the escavation, managing the receiving units so they don't break down as well, or doing whatever possible to minimize losses from a stalled pump.

*Causes of Pump Failure

In an article posted in the Plant Wellness Way EAM website, *List of 600+ Centrifugal Pump Set Failure Modes* indicated there are over 600 *pump* failure modes. In other words, unless you see the actual failed unit it may be difficult to know why the unit failed.This is worrisome to any plant manager interested in meeting deadlines and avoiding pump failures. The article distributes pump failure between human error e.g. installation error, wrong pump being installed, etc and Materials-of-Construction failure i.e. manufacture error.[1] 
With so much at stake, monitoring the pumps becomes a top priority. Organizations are now using artficial intelligence to implement solutions that will improve efficiency and minimize losses.

### PROBLEM STATEMENT
Oil pumps are critical to the efficiency of oil wells. When an oil well is dug, a pump is required to pump the oil out of the well into a storage or to a delivery pipe that delivers the oil into a reservoir near the refinery, where another pump will be used to um the oil into the refinery. When the oils is refined, it will require another pump to pump the oil into other reservoirs waiting distribution. When a (one) pump therefore fails, it's not only costly to remove and replace it, but there is also a cascade effect as it involves not only halting oil production, but transportation as well, jamming reservoirs, and utilizing specialized personnel and equipment to pull the pump out of the well and replace it with a new one according to an article "Pump Failure Prediction."[1] 

If we successfuly predict pump failure before it happens, we can provide this information to the maintenance team who will in turn schedule a close down, and replace all the pumps predicted as calpable to failure. This scheduled maintenance will reduce the indiual replacement cost as specialized pesonnel will pull and replace several pumps; In addition, the prior arrangement will have been made to manage other dependant reservoirs, and also send staff on vacation as the maintenance is being performed.

### DATA SETS AND APPROACH
Our client, a pump manufacturer, provided us with eight data sets i.e BearingWear$Outcome; Cavitation$Outcome; ClosedPressure$Outcome; ClosedSuction$Outcome;CouplingWear$Outcome; Imbalance$Outcome; and Misalignment$Outcome. These data sets were obtained from **factory standards** which we considered to be relatively clean. Our client also provided us with similar data sets obtained from the field.
Using these data sets, we shall use R to read the data sets, modify them where necessary and build a model. We shall then use RandomForest on this model to predict pump failure using the categories afore listed. 


```{r}
BearingWear <- read.csv("C:\\Users\\KRamasundaram\\Documents\\MSDS 6306\\Case Study 2\\Data Set\\Bearing_Wear.csv")
head(BearingWear)
Cavitation <- read.csv("C:\\Users\\KRamasundaram\\Documents\\MSDS 6306\\Case Study 2\\Data Set\\Cavitation.csv")
ClosedPressure <- read.csv("C:\\Users\\KRamasundaram\\Documents\\MSDS 6306\\Case Study 2\\Data Set\\Closed_pressure_side.csv")
ClosedSuction <- read.csv("C:\\Users\\KRamasundaram\\Documents\\MSDS 6306\\Case Study 2\\Data Set\\Closed_Suction_Side.csv")
CouplingWear <- read.csv("C:\\Users\\KRamasundaram\\Documents\\MSDS 6306\\Case Study 2\\Data Set\\Coupling_Wear.csv")
Imbalance <- read.csv("C:\\Users\\KRamasundaram\\Documents\\MSDS 6306\\Case Study 2\\Data Set\\Imbalance.csv")
Misalignment <- read.csv("C:\\Users\\KRamasundaram\\Documents\\MSDS 6306\\Case Study 2\\Data Set\\Misalignment.csv")
Normal_Ops <- read.csv("C:\\Users\\KRamasundaram\\Documents\\MSDS 6306\\Case Study 2\\Data Set\\Normal_Operation.csv")

BearingWear$Outcome <- c("Bearing Wear")
Cavitation$Outcome <- c("Cavitation")
ClosedPressure$Outcome <- c("ClosedPressure")
ClosedSuction$Outcome <- c("ClosedSuction")
CouplingWear$Outcome <- c("CouplingWear")
Imbalance$Outcome <- c("Imbalance")
Misalignment$Outcome <- c("Misalignment")
Normal_Ops <- c("Normal")

clean_data <- merge(BearingWear, Cavitation)
head(clean_data)
head(Cavitation)
clean_data <- rbind(BearingWear, ClosedPressure)
```
library(randomForest)

### Read the data from file
```{r}
BearingWear <- read.csv("C:\\Users\\KRamasundaram\\Documents\\MSDS 6306\\Case Study 2\\Data Set\\Bearing_Wear.csv")
head(BearingWear)
Cavitation <- read.csv("C:\\Users\\KRamasundaram\\Documents\\MSDS 6306\\Case Study 2\\Data Set\\Cavitation.csv")
ClosedPressure <- read.csv("C:\\Users\\KRamasundaram\\Documents\\MSDS 6306\\Case Study 2\\Data Set\\Closed_pressure_side.csv")
ClosedSuction <- read.csv("C:\\Users\\KRamasundaram\\Documents\\MSDS 6306\\Case Study 2\\Data Set\\Closed_Suction_Side.csv")
CouplingWear <- read.csv("C:\\Users\\KRamasundaram\\Documents\\MSDS 6306\\Case Study 2\\Data Set\\Coupling_Wear.csv")
Imbalance <- read.csv("C:\\Users\\KRamasundaram\\Documents\\MSDS 6306\\Case Study 2\\Data Set\\Imbalance.csv")
Misalignment <- read.csv("C:\\Users\\KRamasundaram\\Documents\\MSDS 6306\\Case Study 2\\Data Set\\Misalignment.csv")
Normal_Ops <- read.csv("C:\\Users\\KRamasundaram\\Documents\\MSDS 6306\\Case Study 2\\Data Set\\Normal_Operation.csv")
```

### Added a column for outcome
```{r}
BearingWear$Outcome <- c("Bearing Wear")
Cavitation$Outcome <- c("Cavitation")
ClosedPressure$Outcome <- c("Closed Pressure Side")
ClosedSuction$Outcome <- c("Closed Suction Side")
CouplingWear$Outcome <- c("Coupling Wear")
Imbalance$Outcome <- c("Imbalance")
Misalignment$Outcome <- c("Misalignment")
Normal_Ops$Outcome <- c("Normal")

str(BearingWear)
```

### Splitting the data for validation and model building
```{r}
Bearing_val_data <- BearingWear[c(1:as.integer(0.2*nrow(BearingWear))) ,]
Cavitation_val_data <- Cavitation[c(1:as.integer(0.2*nrow(Cavitation))) ,]
ClosedPressure_val_data <- ClosedPressure[c(1:as.integer(0.2*nrow(ClosedPressure))) ,]
ClosedSuction_val_data <- ClosedSuction[c(1:as.integer(0.2*nrow(ClosedSuction))) ,]
CouplingWear_val_data <- CouplingWear[c(1:as.integer(0.2*nrow(CouplingWear))) ,]
Imbalance_val_data <- Imbalance[c(1:as.integer(0.2*nrow(Imbalance))) ,]
Misalignment_val_data <- Misalignment[c(1:as.integer(0.2*nrow(Misalignment))) ,]
Normal_val_data <- Normal_Ops[c(1:as.integer(0.2*nrow(Normal_Ops))) ,]
```

### combine all validation data
```{r}
validation_data <- rbind (Bearing_val_data, Cavitation_val_data)
validation_data <- rbind(validation_data, ClosedPressure_val_data)
validation_data <- rbind(validation_data, ClosedSuction_val_data)
validation_data <- rbind(validation_data, CouplingWear_val_data)
validation_data <- rbind(validation_data, Imbalance_val_data)
validation_data <- rbind(validation_data, Misalignment_val_data)
validation_data <- rbind(validation_data, Normal_val_data)

dim(validation_data)
```

### Model data
```{r}
Bearing_mod_data <- BearingWear[c(1:as.integer(0.8*nrow(BearingWear))) ,]
Cavitation_mod_data <- Cavitation[c(1:as.integer(0.8*nrow(Cavitation))) ,]
ClosedPressure_mod_data <- ClosedPressure[c(1:as.integer(0.8*nrow(ClosedPressure))) ,]
ClosedSuction_mod_data <- ClosedSuction[c(1:as.integer(0.8*nrow(ClosedSuction))) ,]
CouplingWear_mod_data <- CouplingWear[c(1:as.integer(0.8*nrow(CouplingWear))) ,]
Imbalance_mod_data <- Imbalance[c(1:as.integer(0.8*nrow(Imbalance))) ,]
Misalignment_mod_data <- Misalignment[c(1:as.integer(0.8*nrow(Misalignment))) ,]
Normal_mod_data <- Normal_Ops[c(1:as.integer(0.8*nrow(Normal_Ops))) ,]
```

### Consolidate All Model Data
```{r}
model_data <- rbind (Bearing_mod_data, Cavitation_mod_data)
model_data <- rbind(model_data, ClosedPressure_mod_data)
model_data <- rbind(model_data, ClosedSuction_mod_data)
model_data <- rbind(model_data, CouplingWear_mod_data)
model_data <- rbind(model_data, Imbalance_mod_data)
model_data <- rbind(model_data, Misalignment_mod_data)
model_data <- rbind(model_data, Normal_mod_data)

dim(model_data)
dim(validation_data)

M <- model_data[, c(-1, -2, -38)] #Matrix, so remove target, i.e. outcome
L <- as.factor(model_data[, 38]) #labels, so select only target i.e. outcome
```

### Training and Testing
```{r}
pump.rf <- randomForest(M, L)
# evaluating the model
pump.rf
pump.rf$importance

pred <- predict(pump.rf, validation_data[c(1:10), c(-1, -2, -38)])
pred
```

[1]: Https://www.lifetime-reliability.com/cms/free-articles/reliability-improvement/pump-failure-modes-list/
[1]: Https://www.maana.io/digital-transformation/pump-failure-prediction/
